version: '3.8'

services:
  dst-master:
    image: webhippie/dst:latest
    container_name: dst-master-test  # ← Tên khác
    restart: unless-stopped
    network_mode: host
    environment:
      DST_CLUSTER_TOKEN: ${DST_CLUSTER_TOKEN}
      DST_NETWORK_CLUSTER_NAME: ${DST_CLUSTER_NAME:-haizz club test}
      DST_NETWORK_CLUSTER_PASSWORD: ${DST_CLUSTER_PASSWORD:-haizz}
      DST_GAMEPLAY_MAX_PLAYERS: ${DST_MAX_PLAYERS:-30}
      DST_NETWORK_TICK_RATE: ${DST_TICK_RATE:-30}
      DST_SHARD_ENABLED: "true"
      DST_SHARD_IS_MASTER: "true"
      DST_SHARD_NAME: "Master"
      DST_SHARD_BIND_IP: "127.0.0.1"
      DST_SHARD_MASTER_PORT: "10888"
      DST_SHARD_CLUSTER_KEY: ${DST_SHARD_KEY:-haizzclub2025}
      DST_NETWORK_SERVER_PORT: "10999"
      DST_STEAM_AUTHENTICATION_PORT: "8766"
      DST_STEAM_MASTER_SERVER_PORT: "27016"
    volumes:
      - dst_master_data_test:/var/lib/game  # ← Volume mới

  dst-caves:
    image: webhippie/dst:latest
    container_name: dst-caves-test  # ← Tên khác
    restart: unless-stopped
    network_mode: host
    depends_on:
      - dst-master
    environment:
      DST_CLUSTER_TOKEN: ${DST_CLUSTER_TOKEN}
      DST_SHARD_ENABLED: "true"
      DST_SHARD_IS_MASTER: "false"
      DST_SHARD_NAME: "Caves"
      DST_SHARD_MASTER_IP: "127.0.0.1"
      DST_SHARD_MASTER_PORT: "10888"
      DST_SHARD_CLUSTER_KEY: ${DST_SHARD_KEY:-haizzclub2025}
      DST_NETWORK_SERVER_PORT: "11000"
      DST_STEAM_AUTHENTICATION_PORT: "8767"
      DST_STEAM_MASTER_SERVER_PORT: "27017"
    volumes:
      - dst_caves_data_test:/var/lib/game  # ← Volume mới

volumes:
  dst_master_data_test:  # ← Volume mới
    driver: local
  dst_caves_data_test:   # ← Volume mới
    driver: local
